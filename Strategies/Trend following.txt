# Trend following

> Hurst, Ooi and Pedersen (2013) 的时间序列回归结果表明，虽然 CTA 基金会使用多个策略，例如 Carry 和全球宏观，但是趋势跟踪策略能解释 CTA 基金的绝大部分收益来源。

#### 步骤

1. 定义规则：进场、出场、止损止盈
2. 组合构建：配置哪些板块和品种，如何分配资金，以及定期再平衡
3. 杠杆管理：决定杠杆或者仓位的大小
4. 交易执行：

**趋势跟踪本质上是一个时序策略，只关注资产本身的历史趋势，而不用考虑当前时点其他资产的表现**

## 为何有效？

学术界在解释因子收益来源时，往往从risk-based（经典金融学） & misplacing（行为金融学）角度出发

> 经典金融学：认为一个异象如果能获得超额收益，肯定是承担了某种讨厌的风险，超额收益是这种风险的补偿
> 行为金融学：要么是某种限制阻碍了异象的消失，要么是投资者认知偏差导致的行为不理性

学术界通过研究发现很难从风向补偿角度理解趋势跟踪，但是行为金融学角度解释会容易很多。

### 行为金融学解释

From EMH：当出现某个重要的新信息时，价格会立即得到反应，以匹配最新的内在价值。
-> 行为金融学：由于投资者认知偏差的存在，**市场并不是完全有效，而是慢慢地吸收新信息的影响。**

![](Screen%20Shot%202019-11-09%20at%2011.21.27%20PM.png)

- 初始阶段：由于锚定效应、处置效应和非盈利操作，导致价格对信息反映不足
>> 锚定效应：投资者往往会把自己的观点锚定在最近历史数据上，不愿意很快改变自己的想法，当新消息到来时反应很迟钝，造成价格反应缓慢；
>> 处置效应：投资者往往会过早低卖出盈利股票以兑现收益；相反，对那些亏损的股票迟迟不肯止损。这样的后果是，上涨不会一蹴而就，下跌不会一跌到底，造成价格慢慢的移动；
>> 非盈利操作：一些非盈利操作，也会减缓价格的反应速度，例如中央银行在外汇市场和固定收益市场进行斡旋，以减少汇率和利率的波动。

- 第二阶段：当趋势起来之后，就进入了第二阶段。在这个阶段，趋势会持续甚至过度，主要由于羊群效应以及确认和代表偏差等因素导致的
>> 羊群效应：羊群效应也叫从众效应，当投资者观点和其他大多数投资者观点不一致时，容易怀疑和改变自己的观点，以使得和群体一致。在价格上涨或下跌开启后，投资者会像羊群一样，加入到趋势行情中来；
>> 确认和代表性偏差：行情开启后，投资者会用最近的价格变动来推断未来，选择性地关注最近盈利的方向；不仅如此，一旦确认了自己的观点，便会找各种数据和信息支持自己的看法，这使得价格趋势得以延续。

- 第三阶段：趋势不会永远持续下去，在末段时，价格已经因过度反应而严重偏离基本面，最终会出现反转趋势。（*研究表明，趋势一般会在12个月内存在，12个月后，就会出现反转特征*

### **交易规则**

#### 海龟交易法则 

1. 市场 -- 什么品种
>> 如果最新价格突破过去N日最高价，做多；如果最新价格跌破过去N日最低价，做空
2. 头寸规模 -- 多少数量
3. 入市 -- 何时开仓
4. 止损 -- 何时退出亏损的头寸
5. 离市 -- 何时退出盈利的头寸
>> 如果持有多单，并且最新价格跌破过去M日的最低价，平多
>> 如果持有空单，并且最新价格突破过去M日的最高价，平空
>> 如果没有达到离市条件，但持仓出现了浮亏，当浮亏超过账户价值2%时，必须离场
6. 交易 -- 如何买卖


#### 均线系统

移动平均是过去 N 个交易日价格的加权平均值，可以起到平滑曲线减少噪音的作用。按照加权方式的不同。**Zakamulin (2015) 的研究指出，加权方法并没有显著性差异，简单加权反而看起来更优。**

##### 常见的四种移动均线：

- Momentum rule: $P_t - P_{t-N}$
- Price - minus - Moving - Average rule: $P_t - MA_t(N)$
- Moving Average Change of Direction rule: 
- Double crossover method: $MA_t(N) - MA_{t-1}(N)$

> 以上指标，大于0看多，小于0看空

*长期来看能够轻易打败市场，但在短期和中期其表现并不稳定甚至经常跑输市场*

*Yang et al. (2019)* 认为，基于资产过去收益率符号的规则（过去 N 个月的收益率符号），要么是多头，要么是空头，无论何时都会持有仓位，即使没有明显趋势的时候也会持仓，这样会过度受到噪音的影响

> *Baltas and Kosowski (2017)* 也讨论过这个问题，他们认为，更精细的交易规则能提升趋势跟踪模型的效果，于是提出了另外一个规则，用收益率的 Newey-West t 统计量作为指标，这样就不会陷入要么 1 要么 -1 的争论。具体来说，对于某个资产，计算其过去 12 个月的日收益率的 Newey-West t 统计量，那么信号为为：  

![](Screen%20Shot%202019-11-29%20at%207.16.53%20PM.png)

\
<mark>对于第一个问题，Levine and Pedersen (2016) 做过比较详尽的讨论。双均线模型 MACOROSS 是过去价格的加权平均，时间序列动量 TSMOM 是过去价格变化或收益率的加权平均，通过数学变换可以将两者联系起来，实现相互转换。事实上，很多其他的趋势跟踪规则，包括 HP Filter、Kalman Filter 和 OLS 趋势线等，本质上都可以转化为 TSMOM 或 MACROSS，即趋势跟踪规则虽然计算方法千奇百怪，但是内核几乎没啥差别。因此作者得出结论，由于许多趋势跟踪规则是相似的，与其花费大量精力在趋势跟踪规则的定义上，还不如多琢磨琢磨如何减少成本、周期选择、组合构建、风险管理和挖掘其它因子</mark>


**参数选择**

| 短周期参数 | 长周期参数 |
|:--|:--|
| 更加灵敏的捕捉最新信息 | 擅长捕捉较大的行情 |
| 信号产生较为频繁 | 信号反应迟钝 |
| 更容易受到短期噪音影响 |  |
| 换手率高，交易费用高 |  |

\
<mark>由于底层逻辑都一样，当没有出现明显的上涨或下跌行情时，无论是规则设计多么复杂精妙，无论是短期中期还是长期，都无法获得可观的收益。趋势跟踪喜欢资产价格较大。在实际设计趋势跟踪组合时，最好是多周期多规则结合，一方面减少参数的过度依赖，另一方面也能减少冲击成本提升策略容量。</mark>

![](Screen%20Shot%202019-11-29%20at%207.39.02%20PM.png)

趋势跟踪除了能给已有的资产类型带来多样性外，还能在市场大跌时带来优异的表现（危机Alpha）

### 如何分配资金

1.  等权重
2.  最大分散度（Diversification Ratio)
3.  风险加权
> $w_i = \frac{(\sigma_i^k)^-1}{\sum_{j=1}^{S_t}(\sigma_j^k)^-1}$
> 
> 风险加权只需要考虑每个成分的风险，不需要对成分之间的相关关系进行预测，因此也被称为 Naive Risk Parity。风险加权是风险平价的简化形式，当成分之间的相关系数相等时，波动率倒数加权等同于风险平价。

4. 风险平价
> **追求所有成分对组合的风险贡献相同**
> 
> $Marginal Risk Contributions(MRC_i) = \frac{\vartheta_{\sigma_p}}{\delta_{w_i}} = \frac{w_i\sigma_i^2 + {\sum_j\ne i} w_j\sigma_ij }{\sigma_p^2}$
> 
> $RC_i = w_i * MRC_i = \frac{w_i^2\sigma_i^2 + {\sum_j\ne i} w_iw_j\sigma_ij }{\sigma_p^2}$
> 
> $\sigma_p = \sum_{I=1}^{N}RC_i$
> 
> 需要实现: $RC_i = RC_j$
> 
> 目标函数: $min\sum_{I=1}^{N}\sum{j=1}^{N}(RC_i - RC_j)^2$
[^https://mp.weixin.qq.com/s/EQHXK-rqgYL6d5otLanMBQ]